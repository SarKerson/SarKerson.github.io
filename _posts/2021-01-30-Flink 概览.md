---
layout:     post
title:      Flink æ¦‚è§ˆ
subtitle:   Flink - An Overview
date:       2021-01-30
author:     Eric.Y
catalog: true
tags:
    - computation
---

# Flink - An Overview

> TL;DR æœ¬æ–‡ç®€è¦ä»‹ç»äº† Flink çš„æ¶æ„åŠæä¾›çš„ç‰¹æ€§ï¼Œæ¢³ç†äº†æµå¤„ç†ä¸­å‡ ä¸ªå…³é”®æ¦‚å¿µï¼Œä¾‹å¦‚æ—¶é—´ã€çª—å£ã€æµçŠ¶æ€ï¼Œå¹¶å¯¹æ¯”äº†æµå¤„ç†åœ¨ä¸€äº›åº”ç”¨åœºæ™¯ä¸‹çš„ä¼˜åŠ¿ã€‚è®©è¯»è€…äº†è§£ï¼ŒFlink æ˜¯ä»€ä¹ˆï¼Œç”¨ Flink èƒ½åšäº›ä»€ä¹ˆã€‚å¦‚æœ‰ç–æ¼ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚

# Overview

Apache Flink æ˜¯ä¸€ä¸ªåœ¨æ— ç•Œå’Œæœ‰ç•Œæ•°æ®æµä¸Šè¿›è¡ŒçŠ¶æ€è®¡ç®—çš„æ¡†æ¶å’Œåˆ†å¸ƒå¼å¤„ç†å¼•æ“ã€‚ Flink å·²ç»å¯ä»¥åœ¨æ‰€æœ‰å¸¸è§çš„é›†ç¾¤ç¯å¢ƒä¸­è¿è¡Œï¼Œå¹¶ä»¥ in-memory çš„é€Ÿåº¦å’Œä»»æ„çš„è§„æ¨¡è¿›è¡Œè®¡ç®—ã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841322_229f7ce9bacfa415e49cbd222466df16)

**æ‰¹å¤„ç†**é’ˆå¯¹çš„æ˜¯æœ‰ç•Œæ•°æ®æµã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œä½ å¯ä»¥é€‰æ‹©åœ¨è®¡ç®—ç»“æœè¾“å‡ºä¹‹å‰è¾“å…¥æ•´ä¸ªæ•°æ®é›†ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ä½ å¯ä»¥å¯¹æ•´ä¸ªæ•°æ®é›†çš„æ•°æ®è¿›è¡Œæ’åºã€ç»Ÿè®¡æˆ–æ±‡æ€»è®¡ç®—åå†è¾“å‡ºç»“æœã€‚

**æµå¤„ç†**æ­£ç›¸åï¼Œå…¶æ¶‰åŠæ— ç•Œæ•°æ®æµã€‚è‡³å°‘ç†è®ºä¸Šæ¥è¯´ï¼Œå®ƒçš„æ•°æ®è¾“å…¥æ°¸è¿œä¸ä¼šç»“æŸï¼Œå› æ­¤ç¨‹åºå¿…é¡»æŒç»­ä¸æ–­åœ°å¯¹åˆ°è¾¾çš„æ•°æ®è¿›è¡Œå¤„ç†ã€‚

åœ¨ Flink ä¸­ï¼Œåº”ç”¨ç¨‹åºç”±ç”¨æˆ·è‡ªå®šä¹‰ç®—å­ç»„æˆï¼Œå³ **streaming dataflows**ã€‚è¿™äº› dataflows å½¢æˆäº†æœ‰å‘å›¾ï¼Œä»¥ä¸€ä¸ªæˆ–å¤šä¸ª **source** å¼€å§‹ï¼Œå¹¶ä»¥ä¸€ä¸ªæˆ–å¤šä¸ª **sink** ç»“æŸã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841344_7b5cb803c44619374e0e0cf271335a08)

Flink åº”ç”¨ç¨‹åºå¯ä»¥æ¶ˆè´¹æ¥è‡ªæ¶ˆæ¯é˜Ÿåˆ—æˆ–åˆ†å¸ƒå¼æ—¥å¿—è¿™ç±»æµå¼æ•°æ®æºï¼ˆä¾‹å¦‚ Apache Kafka æˆ– Kinesisï¼‰çš„å®æ—¶æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä»å„ç§çš„æ•°æ®æºä¸­æ¶ˆè´¹æœ‰ç•Œçš„å†å²æ•°æ®ã€‚åŒæ ·ï¼ŒFlink åº”ç”¨ç¨‹åºç”Ÿæˆçš„ç»“æœæµä¹Ÿå¯ä»¥ sink åˆ°å„ç§å­˜å‚¨ç³»ç»Ÿä¸­ã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841510_fa366a1efea01c0287013d314e3b88c2)

# æ¶æ„

å½“ Flink é›†ç¾¤å¯åŠ¨åï¼Œé¦–å…ˆä¼šå¯åŠ¨ä¸€ä¸ª JobManger å’Œä¸€ä¸ªæˆ–å¤šä¸ªçš„ TaskManagerã€‚ç”± Client æäº¤ä»»åŠ¡ç»™ JobManagerï¼ŒJobManager å†è°ƒåº¦ä»»åŠ¡åˆ°å„ä¸ª TaskManager å»æ‰§è¡Œï¼Œç„¶å TaskManager å°†å¿ƒè·³å’Œç»Ÿè®¡ä¿¡æ¯æ±‡æŠ¥ç»™ JobManagerã€‚TaskManager ä¹‹é—´ä»¥æµçš„å½¢å¼è¿›è¡Œæ•°æ®çš„ä¼ è¾“ã€‚ä¸Šè¿°ä¸‰è€…å‡ä¸ºç‹¬ç«‹çš„ JVM è¿›ç¨‹ã€‚

- **Client** ä¸ºæäº¤ Job çš„å®¢æˆ·ç«¯ï¼Œå¯ä»¥æ˜¯è¿è¡Œåœ¨ä»»ä½•æœºå™¨ä¸Šï¼ˆä¸ JobManager ç¯å¢ƒè¿é€šå³å¯ï¼‰ã€‚æäº¤ Job åï¼ŒClient å¯ä»¥ç»“æŸè¿›ç¨‹ï¼ˆStreamingçš„ä»»åŠ¡ï¼‰ï¼Œä¹Ÿå¯ä»¥ä¸ç»“æŸå¹¶ç­‰å¾…ç»“æœè¿”å›ã€‚
- **JobManager** ä¸»è¦è´Ÿè´£è°ƒåº¦ Job å¹¶åè°ƒ Task åš checkpointã€‚ä» Client å¤„æ¥æ”¶åˆ° Job å’Œ JAR åŒ…ç­‰èµ„æºåï¼Œä¼šç”Ÿæˆä¼˜åŒ–åçš„æ‰§è¡Œè®¡åˆ’ï¼Œå¹¶ä»¥ Task çš„å•å…ƒè°ƒåº¦åˆ°å„ä¸ª TaskManager å»æ‰§è¡Œã€‚
- **TaskManager** åœ¨å¯åŠ¨çš„æ—¶å€™å°±è®¾ç½®å¥½äº†æ§½ä½æ•°ï¼ˆSlotï¼‰ï¼Œæ¯ä¸ª slot èƒ½å¯åŠ¨ä¸€ä¸ª Taskï¼ŒTask ä¸ºçº¿ç¨‹ã€‚ä» JobManager å¤„æ¥æ”¶éœ€è¦éƒ¨ç½²çš„ Taskï¼Œéƒ¨ç½²å¯åŠ¨åï¼Œä¸è‡ªå·±çš„ä¸Šæ¸¸å»ºç«‹ Netty è¿æ¥ï¼Œæ¥æ”¶æ•°æ®å¹¶å¤„ç†ã€‚

å¯ä»¥çœ‹åˆ° Flink çš„ä»»åŠ¡è°ƒåº¦æ˜¯å¤šçº¿ç¨‹æ¨¡å‹ï¼Œå¹¶ä¸”ä¸åŒ Job/Task æ··åˆåœ¨ä¸€ä¸ª TaskManager è¿›ç¨‹ä¸­ã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841354_489da73b2a36833bd8976a7861518bc6)

## JobManager

*JobManager* å…·æœ‰è®¸å¤šä¸åè°ƒ Flink åº”ç”¨ç¨‹åºçš„åˆ†å¸ƒå¼æ‰§è¡Œæœ‰å…³çš„èŒè´£ï¼šå®ƒå†³å®šä½•æ—¶è°ƒåº¦ä¸‹ä¸€ä¸ª taskï¼ˆæˆ–ä¸€ç»„ taskï¼‰ã€å¯¹å®Œæˆçš„ task æˆ–æ‰§è¡Œå¤±è´¥åšå‡ºååº”ã€åè°ƒ checkpointã€å¹¶ä¸”åè°ƒä»å¤±è´¥ä¸­æ¢å¤ç­‰ç­‰ã€‚è¿™ä¸ªè¿›ç¨‹ç”±ä¸‰ä¸ªä¸åŒçš„ç»„ä»¶ç»„æˆï¼š

1. **ResourceManagerï¼š** *ResourceManager* è´Ÿè´£ Flink é›†ç¾¤ä¸­çš„èµ„æºæä¾›ã€å›æ”¶ã€åˆ†é… - å®ƒç®¡ç† **task slots**ï¼Œè¿™æ˜¯ Flink é›†ç¾¤ä¸­èµ„æºè°ƒåº¦çš„å•ä½ã€‚Flink ä¸ºä¸åŒçš„ç¯å¢ƒå’Œèµ„æºæä¾›è€…ï¼ˆä¾‹å¦‚ YARNã€Mesosã€Kubernetes å’Œ standalone éƒ¨ç½²ï¼‰å®ç°äº†å¯¹åº”çš„ ResourceManagerã€‚åœ¨ standalone è®¾ç½®ä¸­ï¼ŒResourceManager åªèƒ½åˆ†é…å¯ç”¨ TaskManager çš„ slotsï¼Œè€Œä¸èƒ½è‡ªè¡Œå¯åŠ¨æ–°çš„ TaskManagerã€‚
2. **Dispatcherï¼š** *Dispatcher* æä¾›äº†ä¸€ä¸ª REST æ¥å£ï¼Œç”¨æ¥æäº¤ Flink åº”ç”¨ç¨‹åºæ‰§è¡Œï¼Œå¹¶ä¸ºæ¯ä¸ªæäº¤çš„ä½œä¸šå¯åŠ¨ä¸€ä¸ªæ–°çš„ JobMasterã€‚å®ƒè¿˜è¿è¡Œ Flink WebUI ç”¨æ¥æä¾›ä½œä¸šæ‰§è¡Œä¿¡æ¯ã€‚
3. **JobMasterï¼š** *JobMaster* è´Ÿè´£ç®¡ç†å•ä¸ª[JobGraph](https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/glossary.html#logical-graph)çš„æ‰§è¡Œã€‚Flink é›†ç¾¤ä¸­å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªä½œä¸šï¼Œæ¯ä¸ªä½œä¸šéƒ½æœ‰è‡ªå·±çš„ JobMasterã€‚

å§‹ç»ˆè‡³å°‘æœ‰ä¸€ä¸ª JobManagerã€‚é«˜å¯ç”¨ï¼ˆHAï¼‰è®¾ç½®ä¸­å¯èƒ½æœ‰å¤šä¸ª JobManagerï¼Œå…¶ä¸­ä¸€ä¸ªå§‹ç»ˆæ˜¯ *leader*ï¼Œå…¶ä»–çš„åˆ™æ˜¯ *standby*ï¼ˆè¯·å‚è€ƒ [é«˜å¯ç”¨ï¼ˆHAï¼‰](https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/)ï¼‰ã€‚

## TaskManagers

*TaskManager*ï¼ˆä¹Ÿç§°ä¸º *worker*ï¼‰æ‰§è¡Œä½œä¸šæµçš„ taskï¼Œå¹¶ä¸”ç¼“å­˜å’Œäº¤æ¢æ•°æ®æµã€‚

å¿…é¡»å§‹ç»ˆè‡³å°‘æœ‰ä¸€ä¸ª TaskManagerã€‚åœ¨ TaskManager ä¸­èµ„æºè°ƒåº¦çš„æœ€å°å•ä½æ˜¯ task *slot*ã€‚TaskManager ä¸­ task slot çš„æ•°é‡è¡¨ç¤ºå¹¶å‘å¤„ç† task çš„æ•°é‡ã€‚è¯·æ³¨æ„ä¸€ä¸ª task slot ä¸­å¯ä»¥æ‰§è¡Œå¤šä¸ªç®—å­ã€‚

## Task

å¯¹äºåˆ†å¸ƒå¼æ‰§è¡Œï¼ŒFlink å°†ç®—å­çš„ subtasks *é“¾æ¥*æˆ *tasks*ã€‚æ¯ä¸ª task ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚å°†ç®—å­é“¾æ¥æˆ task æ˜¯ä¸ªæœ‰ç”¨çš„ä¼˜åŒ–ï¼šå®ƒå‡å°‘çº¿ç¨‹é—´åˆ‡æ¢ã€ç¼“å†²çš„å¼€é”€ï¼Œå¹¶ä¸”å‡å°‘å»¶è¿Ÿçš„åŒæ—¶å¢åŠ æ•´ä½“ååé‡ã€‚

ä¸‹å›¾ä¸­æ ·ä¾‹æ•°æ®æµç”¨ 5 ä¸ª subtask æ‰§è¡Œï¼Œå› æ­¤æœ‰ 5 ä¸ªå¹¶è¡Œçº¿ç¨‹ã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841313_5bdb3ff13b15788f9b1333e26dccd95d)

## Task Slots å’Œèµ„æº

æ¯ä¸ª workerï¼ˆTaskManagerï¼‰éƒ½æ˜¯ä¸€ä¸ª *JVM è¿›ç¨‹*ï¼Œå¯ä»¥åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ª subtaskã€‚ä¸ºäº†æ§åˆ¶ä¸€ä¸ª TaskManager ä¸­æ¥å—å¤šå°‘ä¸ª taskï¼Œå°±æœ‰äº†æ‰€è°“çš„ **task slots**ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰ã€‚

æ¯ä¸ª *task slot* ä»£è¡¨ TaskManager ä¸­èµ„æºçš„å›ºå®šå­é›†ã€‚ä¾‹å¦‚ï¼Œå…·æœ‰ 3 ä¸ª slot çš„ TaskManagerï¼Œä¼šå°†å…¶æ‰˜ç®¡å†…å­˜ 1/3 ç”¨äºæ¯ä¸ª slotã€‚åˆ†é…èµ„æºæ„å‘³ç€ subtask ä¸ä¼šä¸å…¶ä»–ä½œä¸šçš„ subtask ç«äº‰æ‰˜ç®¡å†…å­˜ï¼Œè€Œæ˜¯å…·æœ‰ä¸€å®šæ•°é‡çš„ä¿ç•™æ‰˜ç®¡å†…å­˜ã€‚**æ³¨æ„æ­¤å¤„æ²¡æœ‰ CPU éš”ç¦»ï¼›å½“å‰ slot ä»…åˆ†ç¦» task çš„æ‰˜ç®¡å†…å­˜ã€‚**

é€šè¿‡è°ƒæ•´ task slot çš„æ•°é‡ï¼Œç”¨æˆ·å¯ä»¥å®šä¹‰ subtask å¦‚ä½•äº’ç›¸éš”ç¦»ã€‚æ¯ä¸ª TaskManager æœ‰ä¸€ä¸ª slotï¼Œè¿™æ„å‘³ç€æ¯ä¸ª task ç»„éƒ½åœ¨å•ç‹¬çš„ JVM ä¸­è¿è¡Œï¼ˆä¾‹å¦‚ï¼Œå¯ä»¥åœ¨å•ç‹¬çš„å®¹å™¨ä¸­å¯åŠ¨ï¼‰ã€‚å…·æœ‰å¤šä¸ª slot æ„å‘³ç€æ›´å¤š subtask å…±äº«åŒä¸€ JVMã€‚åŒä¸€ JVM ä¸­çš„ task å…±äº« TCP è¿æ¥ï¼ˆé€šè¿‡å¤šè·¯å¤ç”¨ï¼‰å’Œå¿ƒè·³ä¿¡æ¯ã€‚å®ƒä»¬è¿˜å¯ä»¥å…±äº«æ•°æ®é›†å’Œæ•°æ®ç»“æ„ï¼Œä»è€Œå‡å°‘äº†æ¯ä¸ª task çš„å¼€é”€ã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841431_1e0decbca08860a5600bf5a1a81d1aa3)

é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlink å…è®¸ subtask å…±äº« slotï¼Œå³ä¾¿å®ƒä»¬æ˜¯ä¸åŒçš„ task çš„ subtaskï¼Œåªè¦æ˜¯æ¥è‡ªäºåŒä¸€ä½œä¸šå³å¯ã€‚ç»“æœå°±æ˜¯ä¸€ä¸ª slot å¯ä»¥æŒæœ‰æ•´ä¸ªä½œä¸šç®¡é“ã€‚å…è®¸ *slot å…±äº«*æœ‰ä¸¤ä¸ªä¸»è¦ä¼˜ç‚¹ï¼š

- Flink é›†ç¾¤æ‰€éœ€çš„ task slot å’Œä½œä¸šä¸­ä½¿ç”¨çš„æœ€å¤§å¹¶è¡Œåº¦æ°å¥½ä¸€æ ·ã€‚æ— éœ€è®¡ç®—ç¨‹åºæ€»å…±åŒ…å«å¤šå°‘ä¸ª taskï¼ˆå…·æœ‰ä¸åŒå¹¶è¡Œåº¦ï¼‰ã€‚
- å®¹æ˜“è·å¾—æ›´å¥½çš„èµ„æºåˆ©ç”¨ã€‚å¦‚æœæ²¡æœ‰ slot å…±äº«ï¼Œéå¯†é›† subtaskï¼ˆ*source/map()* ï¼‰å°†é˜»å¡å’Œå¯†é›†å‹ subtaskï¼ˆ*window*ï¼‰ ä¸€æ ·å¤šçš„èµ„æºã€‚é€šè¿‡ slot å…±äº«ï¼Œæˆ‘ä»¬ç¤ºä¾‹ä¸­çš„åŸºæœ¬å¹¶è¡Œåº¦ä» 2 å¢åŠ åˆ° 6ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨åˆ†é…çš„èµ„æºï¼ŒåŒæ—¶ç¡®ä¿ç¹é‡çš„ subtask åœ¨ TaskManager ä¹‹é—´å…¬å¹³åˆ†é…ã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841462_d5cc711a8ec9e0db23d206bf9abdcff8)

# æ¦‚å¿µ

## Dataflows

Flink ç¨‹åºæœ¬è´¨ä¸Šæ˜¯åˆ†å¸ƒå¼å¹¶è¡Œç¨‹åºã€‚åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´ï¼Œä¸€ä¸ªæµæœ‰ä¸€ä¸ªæˆ–å¤šä¸ª**æµåˆ†åŒº**ï¼ˆStream Partitionï¼‰ï¼Œæ¯ä¸ªç®—å­æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª**å­ä»»åŠ¡**ï¼ˆOperator Subtaskï¼‰ã€‚æ¯ä¸ªå­ä»»åŠ¡å½¼æ­¤ç‹¬ç«‹ï¼Œå¹¶åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­è¿è¡Œï¼Œæˆ–åœ¨ä¸åŒçš„è®¡ç®—æœºæˆ–å®¹å™¨ä¸­è¿è¡Œã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841374_3d3e23fad83b148e3ef4af64ca2318b4)

Flink ç®—å­ä¹‹é—´å¯ä»¥é€šè¿‡*ä¸€å¯¹ä¸€*ï¼ˆone-to-oneï¼‰æ¨¡å¼æˆ–*é‡åˆ†é…ï¼ˆredistributingï¼‰* æ¨¡å¼ä¼ è¾“æ•°æ®ï¼š

- **ä¸€å¯¹ä¸€**æ¨¡å¼ï¼ˆä¾‹å¦‚ä¸Šå›¾ä¸­çš„ *Source* å’Œ *map()* ç®—å­ä¹‹é—´ï¼‰å¯ä»¥ä¿ç•™å…ƒç´ çš„åˆ†åŒºå’Œé¡ºåºä¿¡æ¯ã€‚è¿™æ„å‘³ç€ *map()* ç®—å­çš„ subtask [1] è¾“å…¥çš„æ•°æ®ä»¥åŠå…¶é¡ºåºä¸ *Source* ç®—å­çš„ subtask [1] è¾“å‡ºçš„æ•°æ®å’Œé¡ºåºå®Œå…¨ç›¸åŒï¼Œå³åŒä¸€åˆ†åŒºçš„æ•°æ®åªä¼šè¿›å…¥åˆ°ä¸‹æ¸¸ç®—å­çš„åŒä¸€åˆ†åŒºã€‚
- **é‡åˆ†é…**æ¨¡å¼ï¼ˆä¾‹å¦‚ä¸Šå›¾ä¸­çš„ *map()* å’Œ *keyBy/window* ä¹‹é—´ï¼Œä»¥åŠ *keyBy/window* å’Œ *Sink* ä¹‹é—´ï¼‰åˆ™ä¼šæ›´æ”¹æ•°æ®æ‰€åœ¨çš„æµåˆ†åŒºã€‚è¯¥æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªç®—å­ä¼šå°†æ•°æ®å‘é€åˆ°å¤šä¸ªç›®æ ‡å­ä»»åŠ¡ä¸­ï¼Œä¾‹å¦‚ *keyBy()* ï¼ˆé€šè¿‡æ•£åˆ—é”®é‡æ–°åˆ†åŒºï¼‰ã€*broadcast()* ï¼ˆå¹¿æ’­ï¼‰æˆ– *rebalance()* ï¼ˆéšæœºé‡æ–°åˆ†å‘ï¼‰ã€‚åœ¨é‡åˆ†é…æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå…ƒç´ åªæœ‰åœ¨æ¯å¯¹è¾“å‡ºå’Œè¾“å…¥å­ä»»åŠ¡ä¹‹é—´æ‰èƒ½ä¿ç•™å…¶ä¹‹é—´çš„é¡ºåºä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œ *keyBy/window* çš„ subtask [2] æ¥æ”¶åˆ°çš„ *map()* çš„ subtask [1] ä¸­çš„å…ƒç´ éƒ½æ˜¯æœ‰åºçš„ï¼‰ã€‚å› æ­¤ï¼Œä¸Šå›¾æ‰€ç¤ºçš„ *keyBy/window* å’Œ *Sink* ç®—å­ä¹‹é—´æ•°æ®çš„é‡æ–°åˆ†å‘æ—¶ï¼Œä¸åŒé”®ï¼ˆkeyï¼‰çš„èšåˆç»“æœåˆ°è¾¾ Sink çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚

## æ—¶é—´

> è¯¦æƒ…å¯è§ğŸ‘‰ [å®˜æ–¹æ–‡æ¡£](https://ci.apache.org/projects/flink/flink-docs-release-1.12/concepts/timely-stream-processing.html)

å¯¹äºå¤§å¤šæ•°æµåº”ç”¨è€Œè¨€ï¼Œèƒ½å¤Ÿä½¿ç”¨åŒä¸€ä»½ä»£ç å¤„ç†å®æ—¶æ•°æ®åŠé‡æ–°å¤„ç†å†å²æ•°æ®ï¼Œäº§ç”Ÿç¡®å®šå¹¶ä¸”ä¸€è‡´çš„ç»“æœéå¸¸æœ‰ä»·å€¼ã€‚

åœ¨å¤„ç†æµå¼æ•°æ®æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æ›´éœ€è¦å…³æ³¨äº‹ä»¶æœ¬èº«å‘ç”Ÿçš„é¡ºåºè€Œä¸æ˜¯äº‹ä»¶è¢«ä¼ è¾“ä»¥åŠå¤„ç†çš„é¡ºåºï¼Œå› ä¸ºè¿™èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ¨ç†å‡ºä¸€ç»„äº‹ä»¶ï¼ˆäº‹ä»¶é›†åˆï¼‰æ˜¯ä½•æ—¶å‘ç”Ÿä»¥åŠç»“æŸçš„ã€‚ä¾‹å¦‚ç”µå­å•†åŠ¡äº¤æ˜“æˆ–é‡‘èäº¤æ˜“ä¸­æ¶‰åŠåˆ°çš„äº‹ä»¶é›†åˆã€‚

ä¸ºäº†æ»¡è¶³ä¸Šè¿°è¿™ç±»çš„å®æ—¶æµå¤„ç†åœºæ™¯ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨è®°å½•åœ¨æ•°æ®æµä¸­çš„äº‹ä»¶æ—¶é—´çš„æ—¶é—´æˆ³ï¼Œè€Œä¸æ˜¯å¤„ç†æ•°æ®çš„æœºå™¨æ—¶é’Ÿçš„æ—¶é—´æˆ³ã€‚

- äº‹ä»¶æ—¶é—´ï¼ˆEvent-Timeï¼‰ï¼šè®¾å¤‡æ—¶é’Ÿï¼Œè®°å½•äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´
- æ‘„å…¥æ—¶é—´ï¼ˆIngestion-Timeï¼‰ï¼šè®¾å¤‡æ—¶é’Ÿï¼Œè®°å½•äº‹ä»¶å‘é€åˆ°æœåŠ¡å™¨çš„æ—¶é—´
- å¤„ç†æ—¶é—´ï¼ˆProcessing-Timeï¼‰ï¼šæœåŠ¡å™¨æ—¶é’Ÿï¼Œè®°å½•æœåŠ¡å™¨å¤„ç†äº‹ä»¶æ—¶çš„æ—¶é—´

### ä½¿ç”¨äº‹ä»¶æ—¶é—´

äº‹ä»¶æ—¶é—´çš„å¼ºå¤§ä¹‹å¤„åœ¨äºï¼Œæ— è®ºæ˜¯åœ¨å¤„ç†å®æ—¶çš„æ•°æ®è¿˜æ˜¯é‡æ–°å¤„ç†å†å²çš„æ•°æ®ï¼ŒåŸºäºäº‹ä»¶æ—¶é—´åˆ›å»ºçš„æµè®¡ç®—åº”ç”¨éƒ½èƒ½ä¿è¯ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œå³å¹‚ç­‰æ€§ã€‚

**ä¸€ä¸ªä½¿ç”¨å¤„ç†æ—¶é—´å¼•å‘çš„é—®é¢˜ï¼š** å¦‚æœæ ¹æ®å¤„ç†æ—¶é—´æ¥è¡¡é‡è¯·æ±‚é¢‘ç‡ï¼Œçœ‹èµ·æ¥é‡å¯åå‡ºç°äº†è¯·æ±‚é«˜å³°ï¼Œä½†æ˜¯å®é™…ä¸Šè¯·æ±‚é¢‘ç‡æ˜¯ç¨³å®šçš„ã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841475_aca2aaaea24a40c7f2235fcb53dd550b)

## æµçŠ¶æ€

> è¯¦æƒ…å¯è§ğŸ‘‰ [å®˜æ–¹æ–‡æ¡£](https://ci.apache.org/projects/flink/flink-docs-release-1.12/concepts/stateful-stream-processing.html)

Flink ä¸­çš„ç®—å­å¯ä»¥æ˜¯æœ‰çŠ¶æ€çš„ã€‚è¿™æ„å‘³ç€å¦‚ä½•å¤„ç†ä¸€ä¸ªäº‹ä»¶å¯èƒ½å–å†³äºè¯¥äº‹ä»¶ä¹‹å‰æ‰€æœ‰äº‹ä»¶æ•°æ®çš„ç´¯ç§¯ç»“æœã€‚Flink ä¸­çš„çŠ¶æ€ä¸ä»…å¯ä»¥ç”¨äºç®€å•çš„åœºæ™¯ï¼ˆä¾‹å¦‚ç»Ÿè®¡ä»ªè¡¨æ¿ä¸Šæ¯åˆ†é’Ÿæ˜¾ç¤ºçš„æ•°æ®ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨äºå¤æ‚çš„åœºæ™¯ï¼ˆä¾‹å¦‚è®­ç»ƒä½œå¼Šæ£€æµ‹æ¨¡å‹ï¼‰ã€‚

Flink åº”ç”¨ç¨‹åºå¯ä»¥åœ¨åˆ†å¸ƒå¼ç¾¤é›†ä¸Šå¹¶è¡Œè¿è¡Œï¼Œå…¶ä¸­æ¯ä¸ªç®—å­çš„å„ä¸ªå¹¶è¡Œå®ä¾‹ä¼šåœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­ç‹¬ç«‹è¿è¡Œï¼Œå¹¶ä¸”é€šå¸¸æƒ…å†µä¸‹æ˜¯ä¼šåœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œã€‚

çŠ¶æ€ç®—å­çš„å¹¶è¡Œå®ä¾‹ç»„åœ¨å­˜å‚¨å…¶å¯¹åº”çŠ¶æ€æ—¶é€šå¸¸æ˜¯æŒ‰ç…§é”®ï¼ˆkeyï¼‰è¿›è¡Œåˆ†ç‰‡å­˜å‚¨çš„ã€‚æ¯ä¸ªå¹¶è¡Œå®ä¾‹ç®—å­è´Ÿè´£å¤„ç†ä¸€ç»„ç‰¹å®šé”®çš„äº‹ä»¶æ•°æ®ï¼Œå¹¶ä¸”è¿™ç»„é”®å¯¹åº”çš„çŠ¶æ€ä¼šä¿å­˜åœ¨æœ¬åœ°ã€‚

å¦‚ä¸‹å›¾çš„ Flink ä½œä¸šï¼Œå…¶å‰ä¸‰ä¸ªç®—å­çš„å¹¶è¡Œåº¦ä¸º 2ï¼Œæœ€åä¸€ä¸ª sink ç®—å­çš„å¹¶è¡Œåº¦ä¸º 1ï¼Œå…¶ä¸­ç¬¬ä¸‰ä¸ªç®—å­æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå¹¶ä¸”ä½ å¯ä»¥çœ‹åˆ°ç¬¬äºŒä¸ªç®—å­å’Œç¬¬ä¸‰ä¸ªç®—å­ä¹‹é—´æ˜¯å…¨äº’è”çš„ï¼ˆfully-connectedï¼‰ï¼Œå®ƒä»¬ä¹‹é—´é€šè¿‡ç½‘ç»œè¿›è¡Œæ•°æ®åˆ†å‘ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå®ç°è¿™ç§ç±»å‹çš„ Flink ç¨‹åºæ˜¯ä¸ºäº†é€šè¿‡æŸäº›é”®å¯¹æ•°æ®æµè¿›è¡Œåˆ†åŒºï¼Œä»¥ä¾¿å°†éœ€è¦ä¸€èµ·å¤„ç†çš„äº‹ä»¶è¿›è¡Œæ±‡åˆï¼Œç„¶ååšç»Ÿä¸€è®¡ç®—å¤„ç†ã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841508_f8e34c09c2b03a0a26da3f1f3f0e7785)

Flink åº”ç”¨ç¨‹åºçš„çŠ¶æ€è®¿é—®éƒ½åœ¨æœ¬åœ°è¿›è¡Œï¼Œå› ä¸ºè¿™æœ‰åŠ©äºå…¶æé«˜ååé‡å’Œé™ä½å»¶è¿Ÿã€‚é€šå¸¸æƒ…å†µä¸‹ Flink åº”ç”¨ç¨‹åºéƒ½æ˜¯å°†çŠ¶æ€å­˜å‚¨åœ¨ JVM å †ä¸Šï¼Œä½†å¦‚æœçŠ¶æ€å¤ªå¤§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å°†å…¶ä»¥ç»“æ„åŒ–æ•°æ®æ ¼å¼å­˜å‚¨åœ¨é«˜é€Ÿç£ç›˜ä¸­ã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841451_6e8e40cc70c35a17443efd9f868d468d)

## çª—å£

> è¯¦æƒ…å¯è§ğŸ‘‰ [å®˜æ–¹æ–‡æ¡£](https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/windows.html)

çª—å£æ˜¯å¤„ç†æ— é™æµçš„æ ¸å¿ƒï¼Œå› ä¸ºçª—å£åœ¨æ— é™æµä¸Šå®šä¹‰äº†ä¸€ä¸ªæœ‰é™çš„å…ƒç´ é›†åˆï¼Œåœ¨è¿™äº›æœ‰é™é›†ä¸Šæ‰§è¡Œè¿ç®—ã€‚ä¸‹é¢ç®€å•ä»‹ç» Flink ä¸­æ¶‰åŠçš„çª—å£ç±»å‹åŠå…¶ç‰¹æ€§ã€‚

### Tumbling Windows

æ»šåŠ¨çª—å£å°†æ¯ä¸ªå…ƒç´ åˆ†é…åˆ°ä¸€ä¸ªæŒ‡å®šå¤§å°çš„çª—å£ä¸­ã€‚é€šå¸¸æ»šåŠ¨çª—å£æœ‰ä¸€ä¸ªå›ºå®šçš„å¤§å°ï¼Œå¹¶ä¸”ä¸ä¼šå‡ºç°é‡å ã€‚ä¾‹å¦‚ï¼šå¦‚æœæŒ‡å®šäº†ä¸€ä¸ª5åˆ†é’Ÿå¤§å°çš„æ»šåŠ¨çª—å£ï¼Œæ— é™æµçš„æ•°æ®ä¼šæ ¹æ®æ—¶é—´åˆ’åˆ†æˆ[0:00 - 0:05)ã€[0:05, 0:10)ã€[0:10, 0:15)ç­‰çª—å£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

é»˜è®¤çš„è¯çª—å£ä¼šæ ¹æ®æ—¶é—´å¯¹é½ï¼Œå³å¦‚æœæ˜¯ä¸€å°æ—¶çš„æ»šåŠ¨çª—å£ï¼Œåˆ™åˆ’åˆ†åçš„çª—å£ä¸º 1:00:00.000 - 1:59:59.999, 2:00:00.000 - 2:59:59.999 ç­‰ç­‰ã€‚Flink æä¾›äº† offset å‚æ•°ï¼Œå¦‚æœæŒ‡å®šäº† offsetï¼Œä¾‹å¦‚ 15minï¼Œåˆ™å°†å¾—åˆ°1:15:00.000 - 2:14:59.999, 2:15:00.000 - 3:14:59.999 çš„çª—å£é›†åˆã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841518_d2e7c4cab4df2002a5d0710ab3c7ce54)

### Sliding Windows

æ»‘åŠ¨çª—å£ä¸åŒäºæ»šåŠ¨çª—å£ï¼Œæ»‘åŠ¨çª—å£çš„çª—å£å¯ä»¥é‡å ã€‚

æ»‘åŠ¨çª—å£æœ‰ä¸¤ä¸ªå‚æ•°ï¼šslide å’Œ sizeã€‚slide ä¸ºæ¯æ¬¡æ»‘åŠ¨çš„æ­¥é•¿ï¼Œsize ä¸ºçª—å£çš„å¤§å°ã€‚

1. slide < sizeï¼Œåˆ™çª—å£ä¼šé‡å ï¼Œæ¯ä¸ªå…ƒç´ ä¼šè¢«åˆ†é…åˆ°å¤šä¸ªçª—å£ã€‚
2. slide = sizeï¼Œåˆ™ç­‰åŒäºæ»šåŠ¨çª—å£ã€‚
3. slide > sizeï¼Œåˆ™ä¸ºè·³è·ƒçª—å£ï¼Œçª—å£ä¹‹é—´ä¸é‡å ä¸”æœ‰é—´éš™ã€‚

é€šå¸¸æƒ…å†µä¸‹å¤§éƒ¨åˆ†å…ƒç´ ç¬¦åˆç¬¬ä¸€ç§æƒ…å½¢ï¼Œçª—å£æ˜¯é‡å çš„ã€‚å› æ­¤ï¼Œæ»‘åŠ¨çª—å£åœ¨è®¡ç®—ç§»åŠ¨å¹³å‡æ•°ï¼ˆmoving averagesï¼‰æ—¶å¾ˆå®ç”¨ã€‚ä¾‹å¦‚ï¼Œè®¡ç®—è¿‡å» 5 åˆ†é’Ÿæ•°æ®çš„å¹³å‡å€¼ï¼Œæ¯ 10 ç§’é’Ÿæ›´æ–°ä¸€æ¬¡ï¼Œå¯ä»¥è®¾ç½® slide ä¸º 10ç§’ï¼Œsize ä¸º 5 åˆ†é’Ÿã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841500_461707ba22e13f568d7376b167d361ea)

### Session Windows

ä¼šè¯çª—å£æ ¹æ® session æ¥å¯¹å…ƒç´ è¿›è¡Œåˆ†ç»„ã€‚ä¼šè¯çª—å£ä¸æ»šåŠ¨çª—å£å’Œæ»‘åŠ¨çª—å£ç›¸æ¯”ï¼Œæ²¡æœ‰çª—å£é‡å ï¼Œæ²¡æœ‰å›ºå®šçª—å£å¤§å°ã€‚ç›¸åï¼Œå½“å®ƒåœ¨ä¸€ä¸ªå›ºå®šçš„æ—¶é—´å‘¨æœŸå†…ä¸å†æ”¶åˆ°å…ƒç´ ï¼Œå³ session æ–­å¼€æ—¶ï¼Œè¿™ä¸ªçª—å£å°±ä¼šå…³é—­ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç”¨æˆ·çš„é¼ æ ‡ç‚¹å‡»æµï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç”¨æˆ·è¿›è¡ŒåŒºåˆ†ï¼ˆgroup by user_idï¼‰ï¼Œåˆ†ææ¯ä¸ªç”¨æˆ·æ¯å¤©é«˜é¢‘ä½¿ç”¨é¼ æ ‡çš„æ—¶é—´æ®µã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841600_dfe8767245929bc43916e3e14bc2e82c)

### Global Windows

å…¨å±€çª—å£å°†æ‰€æœ‰å…ƒç´ æ±‡é›†åˆ°ä¸€ä¸ªé›†åˆã€‚è¿™ç§çª—å£é€šå¸¸åªä¸è‡ªå®šä¹‰ trigger é…åˆä½¿ç”¨ã€‚å¦åˆ™ï¼Œç”±äºçª—å£æ°¸è¿œä¸ä¼šç»“æŸï¼Œå› æ­¤ä¸ä¼šè§¦å‘ä»»ä½•çª—å£è®¡ç®—ã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841393_525324dfadefb2d964a0b1b56b03a52b)

### çª—å£è®¡ç®—çš„ä¸€äº›æ³¨æ„ç‚¹

çª—å£å¯ä»¥è¢«æŒ‡å®šä¸ºä¸€ä¸ªéå¸¸é•¿çš„æ—¶é—´åŒºé—´ï¼Œä¾‹å¦‚å¤©ã€å‘¨ã€æœˆã€‚ä¸è¿‡è¿™æ„å‘³ç€ç»´æŠ¤å¤§é‡çš„æµçŠ¶æ€ï¼Œé€šå¸¸æ¥è¯´æœ‰ä»¥ä¸‹åŸåˆ™æ¥å¸®åŠ©è¯„ä¼°å…¶å ç”¨çš„å­˜å‚¨ç©ºé—´ï¼š

1. Flink ä¼šå¯¹æ¯ä¸ªçª—å£çš„æ¯ä¸ªå…ƒç´ åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ã€‚å¯¹äºæ»šåŠ¨çª—å£ï¼Œæ¯ä¸ªå…ƒç´ åªä¼šå”¯ä¸€åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼ˆå› ä¸ºæ¯ä¸ªå…ƒç´ å”¯ä¸€å±äºä¸€ä¸ªçª—å£ï¼‰ã€‚ç„¶è€Œï¼Œå¯¹äºæ»‘åŠ¨çª—å£æ¥è¯´ï¼Œæ¯ä¸ªå…ƒç´ ä¼šçª—å£å¤šä¸ªå‰¯æœ¬ã€‚å› æ­¤ï¼Œä¸€ä¸ªæ­¥é•¿ç§’çº§çš„å¤©çº§æ»‘åŠ¨çª—å£ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚
2. ReduceFunctionã€AggregateFunction éƒ½èƒ½å¤Ÿå¤§å¤§å‡å°‘å­˜å‚¨ï¼Œå› ä¸ºæ¯ä¸ªçª—å£åªä¼šå­˜å‚¨ä¸€ä¸ªè®¡ç®—åçš„å€¼ï¼Œè€Œéæ¯ä¸ªå…ƒç´ ä¸€ä¸ªå€¼ã€‚
3. ä½¿ç”¨ Evictor å¯¹èšåˆè®¡ç®—è¿›è¡Œé¢„å¤„ç†ï¼Œæ·˜æ±°ä¸å¿…è¦çš„å…ƒç´ ã€‚

# åº”ç”¨

Apache Flink åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå¼€å‘å’Œè¿è¡Œå¤šç§ä¸åŒç§ç±»çš„åº”ç”¨ç¨‹åºã€‚å®ƒçš„ä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼šæ‰¹æµä¸€ä½“åŒ–ã€ç²¾å¯†çš„çŠ¶æ€ç®¡ç†ã€äº‹ä»¶æ—¶é—´æ”¯æŒä»¥åŠç²¾ç¡®ä¸€æ¬¡çš„çŠ¶æ€ä¸€è‡´æ€§ä¿éšœç­‰ã€‚Flink ä¸ä»…å¯ä»¥è¿è¡Œåœ¨åŒ…æ‹¬ YARNã€ Mesosã€Kubernetes åœ¨å†…çš„å¤šç§èµ„æºç®¡ç†æ¡†æ¶ä¸Šï¼Œè¿˜æ”¯æŒåœ¨è£¸æœºé›†ç¾¤ä¸Šç‹¬ç«‹éƒ¨ç½²ã€‚åœ¨å¯ç”¨é«˜å¯ç”¨é€‰é¡¹çš„æƒ…å†µä¸‹ï¼Œå®ƒä¸å­˜åœ¨å•ç‚¹å¤±æ•ˆé—®é¢˜ã€‚äº‹å®è¯æ˜ï¼ŒFlink å·²ç»å¯ä»¥æ‰©å±•åˆ°æ•°åƒæ ¸å¿ƒï¼Œå…¶çŠ¶æ€å¯ä»¥è¾¾åˆ° TB çº§åˆ«ï¼Œä¸”ä»èƒ½ä¿æŒé«˜ååã€ä½å»¶è¿Ÿçš„ç‰¹æ€§ã€‚ä¸–ç•Œå„åœ°æœ‰å¾ˆå¤šè¦æ±‚ä¸¥è‹›çš„æµå¤„ç†åº”ç”¨éƒ½è¿è¡Œåœ¨ Flink ä¹‹ä¸Šã€‚

## äº‹ä»¶é©±åŠ¨å‹åº”ç”¨

äº‹ä»¶é©±åŠ¨å‹åº”ç”¨æ˜¯ä¸€ç±»å…·æœ‰çŠ¶æ€çš„åº”ç”¨ï¼Œå®ƒä»ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶æµæå–æ•°æ®ï¼Œå¹¶æ ¹æ®åˆ°æ¥çš„äº‹ä»¶è§¦å‘è®¡ç®—ã€çŠ¶æ€æ›´æ–°æˆ–å…¶ä»–å¤–éƒ¨åŠ¨ä½œã€‚

ç›¸åï¼Œäº‹ä»¶é©±åŠ¨å‹åº”ç”¨æ˜¯åŸºäºçŠ¶æ€åŒ–æµå¤„ç†æ¥å®Œæˆã€‚åœ¨è¯¥è®¾è®¡ä¸­ï¼Œæ•°æ®å’Œè®¡ç®—ä¸ä¼šåˆ†ç¦»ï¼ˆä¼ ç»Ÿæ¶æ„ä¸­ï¼Œéœ€è¦å®æ—¶è¯·æ±‚æ•°æ®åº“è·å–ä¸Šä¸‹æ–‡æ•°æ®ï¼‰ï¼Œåº”ç”¨åªéœ€è®¿é—®æœ¬åœ°ï¼ˆå†…å­˜æˆ–ç£ç›˜ï¼‰å³å¯è·å–æ•°æ®ã€‚ç³»ç»Ÿå®¹é”™æ€§çš„å®ç°ä¾èµ–äºå®šæœŸå‘è¿œç¨‹æŒä¹…åŒ–å­˜å‚¨å†™å…¥ checkpointã€‚ä¸‹å›¾æè¿°äº†ä¼ ç»Ÿåº”ç”¨å’Œäº‹ä»¶é©±åŠ¨å‹åº”ç”¨æ¶æ„çš„åŒºåˆ«ã€‚

ä¾‹å¦‚ï¼šå¯¹äºç”¨æˆ·å‘æ–‡æµï¼Œåº”ç”¨éœ€è¦æ£€æŸ¥æŸç¯‡æ–‡ç« æ˜¯å¦æ¶‰å«ŒæŠ„è¢­ï¼Œå‰é¢çš„ pipeline å·²ç»é€šè¿‡ NLP æå–ç›¸åº”çš„ embedding å‘é‡ã€‚é‚£ä¹ˆæœ¬åº”ç”¨åªéœ€è¦å»æŸ¥è¯¢å½“å‰æ–‡ç« çš„ embedding æ˜¯å¦ä¸ Flink æœ¬åœ°ç»´æŠ¤çš„å…¶ä»–å…ƒç´ çš„ embedding çŠ¶æ€å€¼ç›¸è¿‘å³å¯ã€‚å¯ä»¥ç†è§£ä¸ºï¼ŒFlink ç”¨å†…å­˜+ç£ç›˜æ¢å–æ•°æ®åº“è°ƒç”¨ï¼Œå¹¶ä¸”å…¶çŠ¶æ€çš„ç»´æŠ¤æ˜¯ç²¾ç¡®ä¸”å¯é çš„ã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841530_4f797732acdb5cecf63f15266f48706d)

## æ•°æ®åˆ†æåº”ç”¨

æ•°æ®åˆ†æä»»åŠ¡éœ€è¦ä»åŸå§‹æ•°æ®ä¸­æå–æœ‰ä»·å€¼çš„ä¿¡æ¯å’ŒæŒ‡æ ‡ã€‚ä¼ ç»Ÿçš„åˆ†ææ–¹å¼é€šå¸¸æ˜¯åˆ©ç”¨æ‰¹æŸ¥è¯¢ï¼Œæˆ–å°†äº‹ä»¶è®°å½•ä¸‹æ¥å¹¶åŸºäºæ­¤æœ‰é™æ•°æ®é›†æ„å»ºåº”ç”¨æ¥å®Œæˆã€‚ä¸ºäº†å¾—åˆ°æœ€æ–°æ•°æ®çš„åˆ†æç»“æœï¼Œå¿…é¡»å…ˆå°†å®ƒä»¬åŠ å…¥åˆ†ææ•°æ®é›†å¹¶é‡æ–°æ‰§è¡ŒæŸ¥è¯¢æˆ–è¿è¡Œåº”ç”¨ç¨‹åºï¼Œéšåå°†ç»“æœå†™å…¥å­˜å‚¨ç³»ç»Ÿæˆ–ç”ŸæˆæŠ¥å‘Šã€‚

å€ŸåŠ©ä¸€äº›å…ˆè¿›çš„æµå¤„ç†å¼•æ“ï¼Œè¿˜å¯ä»¥å®æ—¶åœ°è¿›è¡Œæ•°æ®åˆ†æã€‚å’Œä¼ ç»Ÿæ¨¡å¼ä¸‹è¯»å–æœ‰é™æ•°æ®é›†ä¸åŒï¼Œæµå¼æŸ¥è¯¢æˆ–åº”ç”¨ä¼šæ¥å…¥å®æ—¶äº‹ä»¶æµï¼ˆä¾‹å¦‚ Kafkaï¼‰ï¼Œå¹¶éšç€äº‹ä»¶æ¶ˆè´¹æŒç»­äº§ç”Ÿå’Œæ›´æ–°ç»“æœã€‚è¿™äº›ç»“æœæ•°æ®å¯èƒ½ä¼šå†™å…¥å¤–éƒ¨æ•°æ®åº“ç³»ç»Ÿæˆ–ä»¥å†…éƒ¨çŠ¶æ€çš„å½¢å¼ç»´æŠ¤ã€‚æŒ‡æ ‡å±•ç¤ºçœ‹æ¿å¯ä»¥ä»å¤–éƒ¨æ•°æ®åº“è¯»å–æ•°æ®æˆ–ç›´æ¥æŸ¥è¯¢åº”ç”¨çš„å†…éƒ¨çŠ¶æ€ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒApache Flink åŒæ—¶æ”¯æŒæµå¼åŠæ‰¹é‡åˆ†æåº”ç”¨ã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841380_768b081f78a78a745240ce4dfeca448b)

é€šå¸¸æ¥è¯´ï¼Œæµå¼åˆ†æç›¸æ¯”äºæ‰¹å¼åˆ†ææœ‰å‡ ä¸ªä¼˜åŠ¿ï¼š

1. æµå¼åˆ†æçœæ‰äº†å‘¨æœŸæ€§çš„æ•°æ®å¯¼å…¥å’ŒæŸ¥è¯¢è¿‡ç¨‹ï¼Œå› æ­¤ä»äº‹ä»¶ä¸­è·å–æŒ‡æ ‡çš„å»¶è¿Ÿæ›´ä½
2. æ‰¹å¼æŸ¥è¯¢å¿…é¡»å¤„ç†é‚£äº›ç”±å®šæœŸå¯¼å…¥å’Œè·å–æ•°æ®å¯¼è‡´çš„è¾¹ç•Œé—®é¢˜ï¼Œè€Œæµå¼æŸ¥è¯¢åˆ™æ— é¡»è€ƒè™‘è¯¥é—®é¢˜ã€‚ä¾‹å¦‚å‰é¢æåˆ°çš„æ»šåŠ¨çª—å£ç»Ÿè®¡ï¼Œæ‰¹å¼åˆ†æéœ€è¦ç²¾ç¡®åœ°å‘¨æœŸæ€§è°ƒåº¦ï¼Œè€Œè°ƒåº¦æœ¬èº«å¼•å…¥äº†è°ƒåº¦æ—¶é—´ä»¥åŠåº”ç”¨å†·å¯åŠ¨æ—¶é—´ï¼Œä¼šæœ‰ä¸€å®šè¯¯å·®ã€‚
3. è€Œå®¹é”™æ€§æ–¹é¢ï¼ŒFlink æä¾›äº†æ•…éšœæ¢å¤æœºåˆ¶ï¼Œè€Œæ‰¹å¼è®¡ç®—é€šå¸¸éœ€è¦ç”±å¤šä¸ªç‹¬ç«‹éƒ¨ä»¶ç»„æˆï¼Œéœ€è¦å‘¨æœŸæ€§åœ°è°ƒåº¦æå–æ•°æ®å’Œæ‰§è¡ŒæŸ¥è¯¢ã€åˆ†æã€‚ä¸€æ—¦æŸä¸ªç»„ä»¶å‡ºé”™ï¼Œåˆ™ä¼šå½±å“åç»­æ­¥éª¤ã€‚

## æ•°æ®ç®¡é“åº”ç”¨

æå–-è½¬æ¢-åŠ è½½ï¼ˆETLï¼‰æ˜¯ä¸€ç§åœ¨å­˜å‚¨ç³»ç»Ÿä¹‹é—´è¿›è¡Œæ•°æ®è½¬æ¢å’Œè¿ç§»çš„å¸¸ç”¨æ–¹æ³•ã€‚ETL ä½œä¸šé€šå¸¸ä¼šå‘¨æœŸæ€§åœ°è§¦å‘ï¼Œå°†æ•°æ®ä»äº‹åŠ¡å‹æ•°æ®åº“æ‹·è´åˆ°åˆ†æå‹æ•°æ®åº“æˆ–æ•°æ®ä»“åº“ã€‚

æ•°æ®ç®¡é“å’Œ ETL ä½œä¸šçš„ç”¨é€”ç›¸ä¼¼ï¼Œéƒ½å¯ä»¥è½¬æ¢ã€ä¸°å¯Œæ•°æ®ï¼Œå¹¶å°†å…¶ä»æŸä¸ªå­˜å‚¨ç³»ç»Ÿç§»åŠ¨åˆ°å¦ä¸€ä¸ªã€‚ä½†æ•°æ®ç®¡é“æ˜¯ä»¥æŒç»­æµæ¨¡å¼è¿è¡Œï¼Œè€Œéå‘¨æœŸæ€§è§¦å‘ã€‚å› æ­¤å®ƒæ”¯æŒä»ä¸€ä¸ªä¸æ–­ç”Ÿæˆæ•°æ®çš„æºå¤´è¯»å–è®°å½•ï¼Œå¹¶å°†å®ƒä»¬ä»¥ä½å»¶è¿Ÿç§»åŠ¨åˆ°ç»ˆç‚¹ã€‚ä¾‹å¦‚ï¼šæ•°æ®ç®¡é“å¯ä»¥ç”¨æ¥ç›‘æ§æ–‡ä»¶ç³»ç»Ÿç›®å½•ä¸­çš„æ–°æ–‡ä»¶ï¼Œå¹¶å°†å…¶æ•°æ®å†™å…¥äº‹ä»¶æ—¥å¿—ï¼›å¦ä¸€ä¸ªåº”ç”¨å¯èƒ½ä¼šå°†äº‹ä»¶æµç‰©åŒ–åˆ°æ•°æ®åº“æˆ–å¢é‡æ„å»ºå’Œä¼˜åŒ–æŸ¥è¯¢ç´¢å¼•ã€‚

ä¸‹å›¾æè¿°äº†å‘¨æœŸæ€§ ETL ä½œä¸šå’ŒæŒç»­æ•°æ®ç®¡é“çš„å·®å¼‚ã€‚

![img](https://tech-proxy.bytedance.net/tos/images/1611997841436_2d710bc4ed7157ec72e23a70a7bb8a2c)

Flink ä¸ºå¤šç§æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼ˆå¦‚ï¼šKafkaã€Kinesisã€Elasticsearchã€JDBCæ•°æ®åº“ç³»ç»Ÿç­‰ï¼‰å†…ç½®äº†è¿æ¥å™¨ã€‚å’Œå‘¨æœŸæ€§ ETL ä½œä¸šç›¸æ¯”ï¼Œæ•°æ®ç®¡é“å¯ä»¥æ˜æ˜¾é™ä½å°†ç«¯åˆ°ç«¯æ•°æ®ä¼ è¾“çš„å»¶è¿Ÿã€‚æ­¤å¤–ï¼Œç”±äºå®ƒèƒ½å¤ŸæŒç»­æ¶ˆè´¹å’Œå‘é€æ•°æ®ï¼Œå› æ­¤ç”¨é€”æ›´å¹¿ï¼Œæ”¯æŒç”¨ä¾‹æ›´å¤šã€‚

ä¾‹å¦‚ï¼Œå¯¹äºç”¨æˆ·å‘æ–‡æµï¼Œç»è¿‡ä¸€ç³»åˆ—å‰ç½® pipeline å¤„ç†ï¼Œæå–äº†å…³é”®è¯ç­‰ä¿¡æ¯ï¼ŒFlink ä½œä¸šå°†æ•°æ®è½¬åŒ–ä¸ºæ‰€éœ€æ ¼å¼ sink åˆ°æ•°æ®åº“ï¼Œå¹¶ sink åˆ°å¦ä¸€ä¸ªäº‹ä»¶æ—¥å¿—æµè¿›è¡Œä¸€ç³»åˆ—åå¤„ç†ï¼Œå¦‚é€å®¡æ ¸ã€å†™ç´¢å¼•ï¼Œç­‰ç­‰ã€‚

# å®¹é”™æœºåˆ¶

> åç»­å°†æ·±å…¥è§£æ Flink å®¹é”™æœºåˆ¶çš„å®ç°ï¼Œä¹Ÿå¯ä»¥å‚è€ƒğŸ‘‰ [å®˜æ–¹æ–‡æ¡£](https://flink.apache.org/features/2018/03/01/end-to-end-exactly-once-apache-flink.html)

é€šè¿‡çŠ¶æ€å¿«ç…§å’Œæµé‡æ”¾ä¸¤ç§æ–¹å¼çš„ç»„åˆï¼ŒFlink èƒ½å¤Ÿæä¾›å¯å®¹é”™çš„ï¼Œç²¾ç¡®ä¸€æ¬¡è®¡ç®—çš„è¯­ä¹‰ã€‚è¿™äº›çŠ¶æ€å¿«ç…§åœ¨æ‰§è¡Œæ—¶ä¼šè·å–å¹¶å­˜å‚¨åˆ†å¸ƒå¼ pipeline ä¸­æ•´ä½“çš„çŠ¶æ€ï¼Œå®ƒä¼šå°†æ•°æ®æºä¸­æ¶ˆè´¹æ•°æ®çš„åç§»é‡è®°å½•ä¸‹æ¥ï¼Œå¹¶å°†æ•´ä¸ª job graph ä¸­ç®—å­è·å–åˆ°è¯¥æ•°æ®ï¼ˆè®°å½•çš„åç§»é‡å¯¹åº”çš„æ•°æ®ï¼‰æ—¶çš„çŠ¶æ€è®°å½•å¹¶å­˜å‚¨ä¸‹æ¥ã€‚å½“å‘ç”Ÿæ•…éšœæ—¶ï¼ŒFlink ä½œä¸šä¼šæ¢å¤ä¸Šæ¬¡å­˜å‚¨çš„çŠ¶æ€ï¼Œé‡ç½®æ•°æ®æºä»çŠ¶æ€ä¸­è®°å½•çš„ä¸Šæ¬¡æ¶ˆè´¹çš„åç§»é‡å¼€å§‹é‡æ–°è¿›è¡Œæ¶ˆè´¹å¤„ç†ã€‚è€Œä¸”çŠ¶æ€å¿«ç…§åœ¨æ‰§è¡Œæ—¶ä¼šå¼‚æ­¥è·å–çŠ¶æ€å¹¶å­˜å‚¨ï¼Œå¹¶ä¸ä¼šé˜»å¡æ­£åœ¨è¿›è¡Œçš„æ•°æ®å¤„ç†é€»è¾‘ã€‚

# Reference

- [Flink æ¦‚è§ˆ](https://ci.apache.org/projects/flink/flink-docs-release-1.12/learn-flink/)
- [Flink å®¹é”™æœºåˆ¶](https://ci.apache.org/projects/flink/flink-docs-release-1.12/learn-flink/fault_tolerance.html)
- [Flink æ¶æ„](https://ci.apache.org/projects/flink/flink-docs-release-1.12/concepts/flink-architecture.html)
- https://ververica.cn/developers-resources
- https://wuchong.me/categories/Flink/
